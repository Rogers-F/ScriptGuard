# ScriptGuard 功能测试清单

## 测试环境
- 操作系统：Windows 10/11
- Conda版本：需已安装
- 测试时间：建议在北京时间工作时间

---

## 🔍 测试准备

### 1. 创建测试脚本

**test_hello.py** (基础测试)
```python
import datetime
import time

print("=" * 50)
print("ScriptGuard 测试脚本")
print("=" * 50)

# 显示当前时间
beijing_tz = datetime.timezone(datetime.timedelta(hours=8))
beijing_time = datetime.datetime.now(beijing_tz)
print(f"\n执行时间: {beijing_time.strftime('%Y-%m-%d %H:%M:%S')} (北京时间)")

# 显示环境信息
import sys
print(f"Python版本: {sys.version}")
print(f"Python路径: {sys.executable}")

# 模拟处理
print("\n开始处理...")
for i in range(5):
    time.sleep(1)
    print(f"进度: {(i+1)*20}%")

print("\n✅ 测试脚本执行成功！")
```

**test_error.py** (错误测试)
```python
print("即将触发错误...")
raise Exception("这是一个测试错误，用于验证错误日志和告警功能")
```

---

## ✅ 功能测试清单

### A. 基础功能测试 (必测)

#### 1. 应用启动
- [ ] 双击ScriptGuard.exe能否正常启动
- [ ] 首次启动是否自动创建database/scriptguard.db
- [ ] 首次启动是否自动创建config/app.yaml
- [ ] 窗口是否正常显示（1400x900）
- [ ] 深色主题是否正确加载

#### 2. 仪表盘页面
- [ ] 仪表盘是否显示统计卡片
- [ ] 数据是否为0（首次启动）
- [ ] 图表是否正常渲染
- [ ] "最近执行"区域是否为空

#### 3. 环境管理
**步骤：**
1. 进入"系统设置 > 环境管理"
2. 点击"刷新环境列表"

**检查：**
- [ ] 是否显示Conda环境列表
- [ ] 环境名称是否正确
- [ ] 环境路径是否存在
- [ ] Python路径是否正确
- [ ] 状态标签（有效/无效）是否准确

#### 4. 任务创建（指定时间模式）
**步骤：**
1. 进入"任务管理"
2. 点击"新建任务"
3. 填写以下信息：
   - 任务名称: `测试任务-指定时间`
   - 脚本路径: `C:\path\to\test_hello.py`（你的实际路径）
   - 执行环境: 选择一个有效环境
   - 执行频率: 选择"指定时间"
   - 时间: 输入当前时间+2分钟（例如现在14:30，输入14:32:00）
   - 失败告警: 开启
   - 启用状态: 开启
4. 保存

**检查：**
- [ ] 任务是否成功创建
- [ ] 任务卡片是否显示在列表中
- [ ] Cron表达式是否正确（如：`0 32 14 * * *`）
- [ ] 执行说明是否正确（如：`每天 14:32:00（北京时间）执行`）

#### 5. 立即执行测试
**步骤：**
1. 在刚创建的任务卡片上点击"▶️ 立即执行"
2. 等待执行完成（约5秒）

**检查：**
- [ ] 是否显示"任务已开始执行"提示
- [ ] 进入"日志监控"，选择该任务
- [ ] 是否看到日志输出（包括"ScriptGuard 测试脚本"等）
- [ ] 日志颜色是否正确（stdout为灰色）
- [ ] 进入"执行历史"
- [ ] 是否有新的执行记录
- [ ] 状态是否为"成功"（绿色）
- [ ] 耗时是否约为5秒

#### 6. 定时执行测试
**步骤：**
1. 等待之前设置的执行时间到达（例如14:32:00）
2. 观察系统行为

**检查：**
- [ ] 到达设定时间后，任务是否自动执行
- [ ] "执行历史"是否新增记录
- [ ] 执行时间是否准确（误差<5秒）
- [ ] 日志是否正确记录

#### 7. 北京时间验证
**步骤：**
1. 创建新任务，使用"指定时间"模式
2. 点击"使用当前时间"按钮
3. 观察填充的时间

**检查：**
- [ ] 填充的时间是否接近当前北京时间
- [ ] "当前北京时间"显示是否每秒更新
- [ ] 时区是否正确（与北京时间对比）

#### 8. Cron表达式各模式测试

**每天模式：**
- [ ] 选择时间：09:30:45
- [ ] 生成Cron：`45 30 9 * * *`
- [ ] 说明：`每天 09:30:45（北京时间）执行`

**每周模式：**
- [ ] 选择：周一、周三、周五
- [ ] 时间：10:00:00
- [ ] 生成Cron：`0 0 10 * * 1,3,5`
- [ ] 说明：`每周 周一、周三、周五 的 10:00:00（北京时间）执行`

**每月模式：**
- [ ] 选择：每月1号
- [ ] 时间：08:00:00
- [ ] 生成Cron：`0 0 8 1 * *`
- [ ] 说明：`每月 1 号 08:00:00（北京时间）执行`

**间隔时间：**
- [ ] 每30分钟
- [ ] 生成Cron：`0 */30 * * * *`
- [ ] 说明：`每 30 分钟 执行一次`

#### 9. 任务编辑
**步骤：**
1. 点击任务卡片的"✏️ 编辑"
2. 修改任务名称
3. 修改执行时间
4. 保存

**检查：**
- [ ] 修改是否成功
- [ ] 任务卡片是否更新
- [ ] Cron表达式是否更新

#### 10. 任务删除
**步骤：**
1. 点击任务卡片的"🗑️ 删除"
2. 确认删除

**检查：**
- [ ] 是否显示确认对话框
- [ ] 删除后任务是否从列表消失
- [ ] 数据库中是否已删除（可选）

---

### B. 高级功能测试

#### 11. 错误处理与告警
**步骤：**
1. 创建任务，使用test_error.py脚本
2. 立即执行

**检查：**
- [ ] 执行历史中状态是否为"失败"（红色）
- [ ] 是否显示错误信息
- [ ] 日志中是否有stderr输出（红色）
- [ ] 如果配置了钉钉/企业微信，是否收到告警（可选）

#### 12. 日志监控
**步骤：**
1. 进入"日志监控"
2. 测试各项功能

**检查：**
- [ ] 任务筛选是否生效
- [ ] 搜索功能是否正常
- [ ] 自动滚动开关是否生效
- [ ] 清空日志是否生效
- [ ] 日志颜色分级是否正确

#### 13. 执行历史
**步骤：**
1. 进入"执行历史"
2. 测试筛选和图表

**检查：**
- [ ] 按任务筛选是否生效
- [ ] 按日期范围筛选是否生效（可选）
- [ ] 执行趋势图是否显示
- [ ] 耗时分布图是否显示
- [ ] 统计数据是否准确
- [ ] 点击"查看日志"是否跳转

#### 14. 系统设置
**步骤：**
1. 进入"系统设置"
2. 修改配置

**检查：**
- [ ] 钉钉Webhook配置是否保存
- [ ] 企业微信Webhook配置是否保存
- [ ] 日志保留天数修改是否生效
- [ ] 最大并发数修改是否生效
- [ ] 点击"重置"是否恢复上次保存的值

#### 15. 数据持久化
**步骤：**
1. 创建几个任务
2. 执行几次
3. 关闭应用
4. 重新启动

**检查：**
- [ ] 任务是否保留
- [ ] 执行历史是否保留
- [ ] 日志是否保留
- [ ] 配置是否保留

---

### C. 性能测试

#### 16. 并发执行
**步骤：**
1. 创建3个任务，设置同一时间执行
2. 等待执行

**检查：**
- [ ] 3个任务是否都执行了
- [ ] 是否有任务被跳过
- [ ] 日志是否混乱
- [ ] 系统资源占用是否正常

#### 17. 长时间运行
**步骤：**
1. 创建任务，每分钟执行一次
2. 让应用运行30分钟以上

**检查：**
- [ ] 内存占用是否稳定（<100MB）
- [ ] 是否有内存泄漏迹象
- [ ] 执行是否准时
- [ ] 日志是否正常记录

---

### D. 边界测试

#### 18. 特殊时间
- [ ] 00:00:00（午夜）
- [ ] 23:59:59（一天结束）
- [ ] 12:00:00（正午）

#### 19. 极限值
- [ ] 日志保留天数：1天
- [ ] 日志保留天数：365天
- [ ] 最大并发：1
- [ ] 最大并发：20

#### 20. 异常情况
- [ ] 脚本路径不存在
- [ ] 环境不存在
- [ ] Cron表达式错误（手动修改数据库）
- [ ] 脚本执行超时（可选）

---

## 📊 测试报告模板

### 测试环境
- 操作系统：Windows 11
- Conda版本：23.x.x
- Python版本：3.11.x
- 测试日期：2024-xx-xx
- 测试人员：xxx

### 测试结果总结
- 总测试项：60+
- 通过：xx
- 失败：xx
- 跳过：xx
- 通过率：xx%

### 发现的问题
1. [问题描述]
   - 严重程度：高/中/低
   - 复现步骤：...
   - 预期结果：...
   - 实际结果：...

### 建议
1. ...
2. ...

---

## 🚀 快速测试流程（10分钟版）

如果时间有限，可以只测试以下核心功能：

1. ✅ 启动应用
2. ✅ 刷新环境列表
3. ✅ 创建测试任务（指定时间模式，当前时间+2分钟）
4. ✅ 立即执行，查看日志
5. ✅ 等待定时执行，查看执行历史
6. ✅ 删除任务
7. ✅ 关闭并重启应用，验证数据持久化

---

## 📝 测试记录表

| 测试项 | 状态 | 备注 |
|-------|------|------|
| 应用启动 | ⬜ 通过 / ⬜ 失败 | |
| 环境扫描 | ⬜ 通过 / ⬜ 失败 | |
| 创建任务 | ⬜ 通过 / ⬜ 失败 | |
| 立即执行 | ⬜ 通过 / ⬜ 失败 | |
| 定时执行 | ⬜ 通过 / ⬜ 失败 | |
| 日志监控 | ⬜ 通过 / ⬜ 失败 | |
| 执行历史 | ⬜ 通过 / ⬜ 失败 | |
| 北京时间 | ⬜ 通过 / ⬜ 失败 | |
| 数据持久化 | ⬜ 通过 / ⬜ 失败 | |

---

**测试完成后，请将结果反馈，以便进行优化改进！**
